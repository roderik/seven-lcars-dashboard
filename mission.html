<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCARS â€¢ Mission Control</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ––</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Antonio:wght@400;500;700&display=swap');
        
        :root {
            --lcars-orange: #ff9900;
            --lcars-gold: #ffcc99;
            --lcars-tan: #cc9966;
            --lcars-peach: #ffcc66;
            --lcars-purple: #cc99cc;
            --lcars-violet: #9999cc;
            --lcars-blue: #9999ff;
            --lcars-sky: #99ccff;
            --lcars-red: #cc6666;
            --lcars-pink: #cc6699;
            --lcars-green: #99cc99;
            --lcars-teal: #66cccc;
            --lcars-white: #ffffcc;
            --lcars-bg: #000000;
            --lcars-text: #ff9900;
            
            --status-active: #99ff99;
            --status-warning: #ffcc00;
            --status-alert: #ff6666;
            --status-offline: #666666;
            
            --panel-bg: rgba(20, 20, 30, 0.95);
            --border-radius: 25px;
            --gap: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--lcars-bg);
            color: var(--lcars-text);
            font-family: 'Antonio', 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Starfield */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: var(--base-opacity); }
            50% { opacity: 1; }
        }

        /* Scanlines */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 3px
            );
            opacity: 0.3;
        }

        /* Main Frame */
        .lcars-frame {
            display: grid;
            grid-template-columns: 160px 1fr;
            grid-template-rows: 70px 1fr 50px;
            height: 100vh;
            gap: 0;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .lcars-header {
            grid-column: 1 / -1;
            display: flex;
            align-items: stretch;
        }

        .header-elbow {
            width: 160px;
            background: var(--lcars-purple);
            border-radius: 0 0 var(--border-radius) 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            color: var(--lcars-bg);
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-elbow:hover {
            filter: brightness(1.2);
        }

        .header-bar {
            flex: 1;
            display: flex;
            align-items: stretch;
            gap: 4px;
            padding-left: 4px;
        }

        .header-segment {
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            color: var(--lcars-bg);
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .header-segment:hover { filter: brightness(1.2); }
        .header-segment.purple { background: var(--lcars-purple); flex: 1; }
        .header-segment.blue { background: var(--lcars-blue); flex: 2; }
        .header-segment.sky { background: var(--lcars-sky); flex: 1; }
        .header-segment.peach { 
            background: var(--lcars-peach); 
            flex: 3;
            justify-content: flex-end;
            border-radius: 0 0 0 var(--border-radius);
        }

        .header-title {
            background: var(--lcars-bg);
            color: var(--lcars-purple);
            padding: 0 30px;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 4px;
            display: flex;
            align-items: center;
            text-shadow: 0 0 20px rgba(204, 153, 204, 0.5);
        }

        .header-end {
            width: 50px;
            background: var(--lcars-orange);
            border-radius: 0 0 0 50px;
        }

        /* Sidebar */
        .lcars-sidebar {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding-top: 4px;
        }

        .sidebar-button {
            background: var(--lcars-tan);
            height: 45px;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 12px;
            font-weight: 700;
            color: var(--lcars-bg);
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .sidebar-button:hover {
            filter: brightness(1.2);
            transform: translateX(5px);
        }

        .sidebar-button.active {
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.5);
        }

        .sidebar-button.purple { background: var(--lcars-purple); }
        .sidebar-button.blue { background: var(--lcars-blue); }
        .sidebar-button.green { background: var(--lcars-green); }
        .sidebar-button.orange { background: var(--lcars-orange); }
        .sidebar-button.sky { background: var(--lcars-sky); }
        .sidebar-button.pink { background: var(--lcars-pink); }
        .sidebar-button.gold { background: var(--lcars-gold); }

        .sidebar-spacer {
            flex: 1;
            background: var(--lcars-tan);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            min-height: 30px;
        }

        .sidebar-elbow-bottom {
            background: var(--lcars-tan);
            height: 35px;
            border-radius: 0 0 0 var(--border-radius);
        }

        /* Main Content - Three Panel Layout */
        .mission-content {
            display: grid;
            grid-template-columns: 280px 1fr 340px;
            gap: var(--gap);
            padding: var(--gap);
            overflow: hidden;
        }

        /* Panel Styling */
        .panel {
            background: var(--panel-bg);
            border: 2px solid var(--lcars-tan);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            display: flex;
            align-items: stretch;
            height: 40px;
            flex-shrink: 0;
        }

        .panel-color-bar {
            width: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: var(--lcars-bg);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .panel-title-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background: rgba(0, 0, 0, 0.5);
        }

        .panel-name {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .panel-body {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LEFT PANEL - AGENTS DIRECTORY
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .agents-panel { border-color: var(--lcars-purple); }
        .agents-panel .panel-color-bar { background: var(--lcars-purple); }
        .agents-panel .panel-name { color: var(--lcars-purple); }

        .agent-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--lcars-purple);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .agent-card:hover {
            background: rgba(0, 0, 0, 0.6);
            transform: translateX(5px);
        }

        .agent-card.selected {
            box-shadow: 0 0 15px rgba(204, 153, 204, 0.5);
        }

        .agent-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .agent-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            color: #000;
        }

        .agent-info {
            flex: 1;
            margin-left: 10px;
        }

        .agent-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--lcars-gold);
        }

        .agent-role {
            font-size: 10px;
            color: var(--lcars-violet);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .agent-status-badge {
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .agent-status-badge.working {
            background: var(--status-active);
            color: #000;
            animation: pulse 2s infinite;
        }

        .agent-status-badge.idle {
            background: var(--lcars-violet);
            color: #000;
        }

        .agent-status-badge.offline {
            background: var(--status-offline);
            color: #fff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .agent-badges {
            display: flex;
            gap: 4px;
            margin-top: 6px;
        }

        .agent-badge {
            padding: 2px 6px;
            background: rgba(255, 153, 0, 0.3);
            border-radius: 4px;
            font-size: 9px;
            font-weight: 700;
            color: var(--lcars-orange);
        }

        .agent-activity {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 10px;
            color: var(--lcars-sky);
        }

        .agent-activity-count {
            font-weight: 700;
            font-size: 14px;
            color: var(--lcars-gold);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CENTER PANEL - MISSION QUEUE (KANBAN)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .mission-panel { border-color: var(--lcars-blue); }
        .mission-panel .panel-color-bar { background: var(--lcars-blue); }
        .mission-panel .panel-name { color: var(--lcars-blue); }

        .kanban-container {
            display: flex;
            gap: 10px;
            height: 100%;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .kanban-column {
            min-width: 180px;
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .kanban-column-header {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid var(--lcars-tan);
        }

        .kanban-column-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kanban-column-count {
            background: var(--lcars-tan);
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
        }

        .kanban-column-body {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .kanban-column[data-status="inbox"] .kanban-column-title { color: var(--lcars-violet); }
        .kanban-column[data-status="assigned"] .kanban-column-title { color: var(--lcars-sky); }
        .kanban-column[data-status="in_progress"] .kanban-column-title { color: var(--lcars-blue); }
        .kanban-column[data-status="review"] .kanban-column-title { color: var(--lcars-orange); }
        .kanban-column[data-status="done"] .kanban-column-title { color: var(--lcars-green); }

        /* Task Card */
        .task-card {
            background: rgba(20, 20, 30, 0.9);
            border: 1px solid var(--lcars-tan);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 153, 0, 0.2);
        }

        .task-card.dragging {
            opacity: 0.5;
        }

        .task-card-priority {
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 10px 0 0 10px;
        }

        .task-card-priority.high { background: var(--status-alert); }
        .task-card-priority.medium { background: var(--status-warning); }
        .task-card-priority.low { background: var(--lcars-violet); }

        .task-card-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--lcars-gold);
            margin-bottom: 6px;
            padding-left: 8px;
        }

        .task-card-desc {
            font-size: 10px;
            color: var(--lcars-violet);
            margin-bottom: 8px;
            padding-left: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .task-card-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-left: 8px;
        }

        .task-card-assignee {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .task-card-assignee-avatar {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: #000;
        }

        .task-card-assignee-name {
            font-size: 10px;
            color: var(--lcars-sky);
        }

        .task-card-category {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 8px;
            font-weight: 700;
            text-transform: uppercase;
            background: rgba(153, 153, 255, 0.2);
            color: var(--lcars-blue);
        }

        .task-card-timestamp {
            font-size: 9px;
            color: var(--lcars-violet);
            margin-top: 6px;
            padding-left: 8px;
        }

        /* Add Task Button */
        .add-task-btn {
            width: 100%;
            padding: 8px;
            background: rgba(255, 153, 0, 0.1);
            border: 1px dashed var(--lcars-tan);
            border-radius: 8px;
            color: var(--lcars-tan);
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-task-btn:hover {
            background: rgba(255, 153, 0, 0.2);
            border-color: var(--lcars-orange);
            color: var(--lcars-orange);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RIGHT PANEL - LIVE FEED
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .feed-panel { border-color: var(--lcars-orange); }
        .feed-panel .panel-color-bar { background: var(--lcars-orange); }
        .feed-panel .panel-name { color: var(--lcars-orange); }

        .feed-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feed-filter {
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--lcars-tan);
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            color: var(--lcars-tan);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .feed-filter:hover {
            background: rgba(255, 153, 0, 0.2);
        }

        .feed-filter.active {
            background: var(--lcars-orange);
            color: #000;
            border-color: var(--lcars-orange);
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .agent-grid-item {
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .agent-grid-item:hover {
            transform: scale(1.1);
        }

        .agent-grid-item.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--status-active);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .feed-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .feed-item {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            border-left: 3px solid var(--lcars-tan);
        }

        .feed-item:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        .feed-item[data-type="task"] { border-left-color: var(--lcars-blue); }
        .feed-item[data-type="comment"] { border-left-color: var(--lcars-green); }
        .feed-item[data-type="decision"] { border-left-color: var(--lcars-purple); }
        .feed-item[data-type="status"] { border-left-color: var(--lcars-orange); }

        .feed-item-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: #000;
            flex-shrink: 0;
        }

        .feed-item-content {
            flex: 1;
            min-width: 0;
        }

        .feed-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .feed-item-agent {
            font-size: 11px;
            font-weight: 700;
            color: var(--lcars-gold);
        }

        .feed-item-time {
            font-size: 9px;
            color: var(--lcars-violet);
        }

        .feed-item-action {
            font-size: 11px;
            color: var(--lcars-sky);
        }

        .feed-item-action strong {
            color: var(--lcars-gold);
        }

        /* Footer */
        .lcars-footer {
            grid-column: 1 / -1;
            display: flex;
            align-items: stretch;
            gap: 4px;
        }

        .footer-elbow {
            width: 160px;
            background: var(--lcars-tan);
            border-radius: 0 var(--border-radius) 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--lcars-bg);
        }

        .footer-bar {
            flex: 1;
            display: flex;
            gap: 4px;
            padding-left: 4px;
        }

        .footer-segment {
            padding: 8px 15px;
            display: flex;
            align-items: center;
            font-size: 12px;
            font-weight: 500;
            color: var(--lcars-bg);
        }

        .footer-segment.purple { background: var(--lcars-purple); flex: 1; border-radius: var(--border-radius) 0 0 0; }
        .footer-segment.blue { background: var(--lcars-blue); flex: 1; }
        .footer-segment.orange { background: var(--lcars-orange); flex: 2; }
        .footer-segment.peach { background: var(--lcars-peach); flex: 1; border-radius: 0 0 0 var(--border-radius); }

        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 60px;
            right: 20px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(10px);
        }

        .connection-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .status-connected {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--status-active);
            color: var(--status-active);
        }

        .status-connected .connection-dot {
            background: var(--status-active);
            animation: pulse 2s infinite;
        }

        .status-disconnected {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--status-alert);
            color: var(--status-alert);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TASK DETAIL MODAL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .task-modal {
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            background: var(--panel-bg);
            border: 2px solid var(--lcars-orange);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .task-modal-header {
            display: flex;
            align-items: stretch;
            height: 50px;
        }

        .task-modal-color-bar {
            width: 80px;
            background: var(--lcars-orange);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: #000;
        }

        .task-modal-title-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: rgba(0, 0, 0, 0.5);
        }

        .task-modal-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--lcars-gold);
        }

        .task-modal-close {
            background: none;
            border: none;
            color: var(--lcars-orange);
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
        }

        .task-modal-close:hover {
            color: var(--lcars-gold);
        }

        .task-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .task-detail-section {
            margin-bottom: 20px;
        }

        .task-detail-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--lcars-tan);
            margin-bottom: 6px;
        }

        .task-detail-value {
            font-size: 14px;
            color: var(--lcars-gold);
            line-height: 1.5;
        }

        .task-detail-meta {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .task-detail-meta-item {
            text-align: center;
        }

        .task-comments {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 15px;
        }

        .comment-item {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .comment-avatar {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: #000;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .comment-author {
            font-size: 11px;
            font-weight: 700;
            color: var(--lcars-gold);
        }

        .comment-time {
            font-size: 9px;
            color: var(--lcars-violet);
        }

        .comment-text {
            font-size: 12px;
            color: var(--lcars-sky);
        }

        .comment-form {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .comment-input {
            flex: 1;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--lcars-tan);
            border-radius: 8px;
            padding: 10px;
            color: var(--lcars-gold);
            font-family: inherit;
            font-size: 12px;
            resize: none;
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--lcars-orange);
        }

        .comment-submit {
            padding: 10px 20px;
            background: var(--lcars-orange);
            border: none;
            border-radius: 8px;
            color: #000;
            font-family: inherit;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .comment-submit:hover {
            filter: brightness(1.2);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--lcars-tan);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--lcars-orange);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .mission-content {
                grid-template-columns: 1fr 1fr;
            }
            .feed-panel {
                grid-column: 1 / -1;
                max-height: 250px;
            }
        }

        @media (max-width: 768px) {
            .lcars-frame {
                grid-template-columns: 1fr;
            }
            .lcars-sidebar {
                display: none;
            }
            .mission-content {
                grid-template-columns: 1fr;
            }
            .agents-panel, .feed-panel {
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="starfield" id="starfield"></div>
    <div class="scanlines"></div>

    <div class="lcars-frame">
        <!-- Header -->
        <div class="lcars-header">
            <a href="/" class="header-elbow">â† BRIDGE</a>
            <div class="header-bar">
                <div class="header-segment purple" id="stardate">47085.2</div>
                <div class="header-title">MISSION CONTROL</div>
                <div class="header-segment blue" id="clock">--:--:--</div>
                <div class="header-segment sky" id="task-count">0 TASKS</div>
                <div class="header-end"></div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lcars-sidebar">
            <a href="/" class="sidebar-button tan">BRIDGE</a>
            <div class="sidebar-button purple active">MISSIONS</div>
            <div class="sidebar-button blue" onclick="showAddTask()">NEW TASK</div>
            <div class="sidebar-spacer"></div>
            <div class="sidebar-elbow-bottom"></div>
        </div>

        <!-- Main Content -->
        <div class="mission-content">
            <!-- Left Panel: Agents -->
            <div class="panel agents-panel">
                <div class="panel-header">
                    <div class="panel-color-bar">CREW</div>
                    <div class="panel-title-area">
                        <div class="panel-name">Agents</div>
                    </div>
                </div>
                <div class="panel-body" id="agents-list">
                    <!-- Agent cards will be rendered here -->
                </div>
            </div>

            <!-- Center Panel: Mission Queue -->
            <div class="panel mission-panel">
                <div class="panel-header">
                    <div class="panel-color-bar">QUEUE</div>
                    <div class="panel-title-area">
                        <div class="panel-name">Mission Queue</div>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="kanban-container" id="kanban-container">
                        <!-- Kanban columns will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Right Panel: Live Feed -->
            <div class="panel feed-panel">
                <div class="panel-header">
                    <div class="panel-color-bar">FEED</div>
                    <div class="panel-title-area">
                        <div class="panel-name">Live Feed</div>
                    </div>
                </div>
                <div class="feed-filters" id="feed-filters">
                    <button class="feed-filter active" data-filter="all">All</button>
                    <button class="feed-filter" data-filter="task">Tasks</button>
                    <button class="feed-filter" data-filter="comment">Comments</button>
                    <button class="feed-filter" data-filter="decision">Decisions</button>
                    <button class="feed-filter" data-filter="status">Status</button>
                </div>
                <div class="agent-grid" id="agent-grid">
                    <!-- Agent avatars will be rendered here -->
                </div>
                <div class="feed-list" id="feed-list">
                    <!-- Feed items will be rendered here -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="lcars-footer">
            <div class="footer-elbow" id="footer-status">ONLINE</div>
            <div class="footer-bar">
                <div class="footer-segment purple" id="footer-active">0 ACTIVE</div>
                <div class="footer-segment blue" id="footer-pending">0 PENDING</div>
                <div class="footer-segment orange" id="footer-update">Last Update: --:--:--</div>
                <div class="footer-segment peach" id="footer-version">v1.0</div>
            </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status status-disconnected" id="connection-status">
        <div class="connection-dot"></div>
        <span id="connection-text">DISCONNECTED</span>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal-overlay" id="task-modal-overlay">
        <div class="task-modal">
            <div class="task-modal-header">
                <div class="task-modal-color-bar">TASK</div>
                <div class="task-modal-title-area">
                    <div class="task-modal-title" id="modal-task-title">Task Title</div>
                    <button class="task-modal-close" onclick="closeTaskModal()">Ã—</button>
                </div>
            </div>
            <div class="task-modal-body">
                <div class="task-detail-meta" id="modal-task-meta">
                    <!-- Meta info will be rendered here -->
                </div>
                <div class="task-detail-section">
                    <div class="task-detail-label">Description</div>
                    <div class="task-detail-value" id="modal-task-desc">Task description...</div>
                </div>
                <div class="task-comments" id="modal-task-comments">
                    <div class="task-detail-label">Comments</div>
                    <!-- Comments will be rendered here -->
                </div>
                <div class="comment-form">
                    <textarea class="comment-input" id="comment-input" placeholder="Add a comment..." rows="2"></textarea>
                    <button class="comment-submit" onclick="addComment()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // LCARS Mission Control v1.0
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        class MissionControl {
            constructor() {
                this.ws = null;
                this.reconnectAttempts = 0;
                this.tasksData = null;
                this.bridgeData = null;
                this.selectedTaskId = null;
                this.activeFilter = 'all';
                
                this.columnLabels = {
                    'inbox': 'Inbox',
                    'assigned': 'Assigned',
                    'in_progress': 'In Progress',
                    'review': 'Review',
                    'done': 'Done'
                };
                
                this.initStarfield();
                this.connect();
                this.startClock();
                this.setupEventListeners();
            }

            initStarfield() {
                const container = document.getElementById('starfield');
                for (let i = 0; i < 80; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.setProperty('--duration', (2 + Math.random() * 4) + 's');
                    star.style.setProperty('--base-opacity', (0.2 + Math.random() * 0.5));
                    container.appendChild(star);
                }
            }

            setupEventListeners() {
                // Filter buttons
                document.querySelectorAll('.feed-filter').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.feed-filter').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.activeFilter = e.target.dataset.filter;
                        this.renderFeed();
                    });
                });

                // Close modal on overlay click
                document.getElementById('task-modal-overlay').addEventListener('click', (e) => {
                    if (e.target.id === 'task-modal-overlay') {
                        closeTaskModal();
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        closeTaskModal();
                    }
                });
            }

            connect() {
                this.updateConnectionStatus('connecting');
                
                try {
                    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    const wsUrl = `${wsProtocol}//${window.location.host}`;
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = () => {
                        console.log('[Mission] Connected');
                        this.reconnectAttempts = 0;
                        this.updateConnectionStatus('connected');
                        // Request task data
                        this.ws.send(JSON.stringify({ type: 'get_tasks' }));
                    };
                    
                    this.ws.onmessage = (event) => {
                        try {
                            const msg = JSON.parse(event.data);
                            this.handleMessage(msg);
                        } catch (e) {
                            console.error('[Mission] Parse error:', e);
                        }
                    };
                    
                    this.ws.onclose = () => {
                        this.updateConnectionStatus('disconnected');
                        this.scheduleReconnect();
                    };
                    
                    this.ws.onerror = () => {
                        console.error('[Mission] WebSocket error');
                    };
                    
                } catch (e) {
                    console.error('[Mission] Connection error:', e);
                    this.scheduleReconnect();
                }
            }

            scheduleReconnect() {
                if (this.reconnectAttempts >= 50) return;
                this.reconnectAttempts++;
                const delay = Math.min(1000 * Math.pow(1.5, this.reconnectAttempts - 1), 30000);
                setTimeout(() => this.connect(), delay);
            }

            updateConnectionStatus(status) {
                const el = document.getElementById('connection-status');
                const text = document.getElementById('connection-text');
                el.className = `connection-status status-${status}`;
                text.textContent = status.toUpperCase();
            }

            handleMessage(msg) {
                if (msg.type === 'init' || msg.type === 'update' || msg.type === 'trade_update') {
                    this.bridgeData = msg.data;
                    this.render();
                }
                if (msg.type === 'tasks' || msg.type === 'tasks_update') {
                    this.tasksData = msg.data;
                    this.render();
                }
            }

            render() {
                this.renderAgents();
                this.renderKanban();
                this.renderFeed();
                this.renderAgentGrid();
                this.updateFooter();
            }

            getAgentStatus(agentKey) {
                if (!this.bridgeData?.crew) return 'idle';
                const crew = this.bridgeData.crew[agentKey];
                if (!crew) return 'idle';
                
                const status = crew.status?.toUpperCase();
                if (status === 'ACTIVE' || status === 'BUILDING' || status === 'PROCESSING' || 
                    status === 'RESEARCHING' || status === 'TRADING') {
                    return 'working';
                }
                if (status === 'OFFLINE') return 'offline';
                return 'idle';
            }

            getAgentTaskCount(agentKey) {
                if (!this.tasksData?.tasks) return 0;
                return this.tasksData.tasks.filter(t => t.assignee === agentKey && t.status !== 'done').length;
            }

            renderAgents() {
                const container = document.getElementById('agents-list');
                if (!this.tasksData?.agents) {
                    container.innerHTML = '<div style="color: var(--lcars-violet); text-align: center; padding: 20px;">Loading agents...</div>';
                    return;
                }

                const agents = this.tasksData.agents;
                container.innerHTML = Object.entries(agents).map(([key, agent]) => {
                    const status = this.getAgentStatus(key);
                    const taskCount = this.getAgentTaskCount(key);
                    
                    return `
                        <div class="agent-card" data-agent="${key}" style="border-left-color: ${agent.color}">
                            <div class="agent-card-header">
                                <div class="agent-avatar" style="background: ${agent.color}">${agent.department}</div>
                                <div class="agent-info">
                                    <div class="agent-name">${agent.name}</div>
                                    <div class="agent-role">${agent.role}</div>
                                </div>
                                <div class="agent-status-badge ${status}">${status}</div>
                            </div>
                            ${agent.badges.length > 0 ? `
                                <div class="agent-badges">
                                    ${agent.badges.map(b => `<span class="agent-badge">${b}</span>`).join('')}
                                </div>
                            ` : ''}
                            <div class="agent-activity">
                                <span>Tasks: <span class="agent-activity-count">${taskCount}</span></span>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderKanban() {
                const container = document.getElementById('kanban-container');
                if (!this.tasksData?.tasks) {
                    container.innerHTML = '<div style="color: var(--lcars-violet); text-align: center; padding: 40px;">Loading tasks...</div>';
                    return;
                }

                const columns = this.tasksData.columns || ['inbox', 'assigned', 'in_progress', 'review', 'done'];
                const tasks = this.tasksData.tasks;
                const agents = this.tasksData.agents || {};

                container.innerHTML = columns.map(status => {
                    const columnTasks = tasks.filter(t => t.status === status);
                    
                    return `
                        <div class="kanban-column" data-status="${status}" 
                             ondragover="event.preventDefault()" 
                             ondrop="mission.dropTask(event, '${status}')">
                            <div class="kanban-column-header">
                                <span class="kanban-column-title">${this.columnLabels[status] || status}</span>
                                <span class="kanban-column-count">${columnTasks.length}</span>
                            </div>
                            <div class="kanban-column-body">
                                ${columnTasks.map(task => this.renderTaskCard(task, agents)).join('')}
                                ${status === 'inbox' ? '<button class="add-task-btn" onclick="showAddTask()">+ Add Task</button>' : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                // Update header task count
                document.getElementById('task-count').textContent = `${tasks.length} TASKS`;
            }

            renderTaskCard(task, agents) {
                const agent = task.assignee ? agents[task.assignee] : null;
                const timeAgo = this.formatTimeAgo(task.updatedAt || task.createdAt);
                
                return `
                    <div class="task-card" 
                         data-task-id="${task.id}"
                         draggable="true"
                         ondragstart="mission.dragTask(event, '${task.id}')"
                         onclick="mission.openTask('${task.id}')">
                        <div class="task-card-priority ${task.priority || 'medium'}"></div>
                        <div class="task-card-title">${this.escapeHtml(task.title)}</div>
                        <div class="task-card-desc">${this.escapeHtml(task.description || '')}</div>
                        <div class="task-card-meta">
                            ${agent ? `
                                <div class="task-card-assignee">
                                    <div class="task-card-assignee-avatar" style="background: ${agent.color}">${agent.department}</div>
                                    <span class="task-card-assignee-name">${agent.name.split(' ')[0]}</span>
                                </div>
                            ` : '<span></span>'}
                            <span class="task-card-category">${task.category || 'general'}</span>
                        </div>
                        <div class="task-card-timestamp">${timeAgo}</div>
                    </div>
                `;
            }

            renderFeed() {
                const container = document.getElementById('feed-list');
                if (!this.tasksData?.activity) {
                    container.innerHTML = '<div style="color: var(--lcars-violet); text-align: center; padding: 20px;">No activity yet</div>';
                    return;
                }

                const agents = this.tasksData.agents || {};
                let activity = [...this.tasksData.activity].reverse();
                
                if (this.activeFilter !== 'all') {
                    activity = activity.filter(a => a.type === this.activeFilter);
                }

                container.innerHTML = activity.slice(0, 20).map(item => {
                    const agent = agents[item.agent] || { name: item.agent, color: '#666', department: '?' };
                    const timeAgo = this.formatTimeAgo(item.timestamp);
                    
                    let actionText = '';
                    switch (item.action) {
                        case 'created':
                            actionText = `created task <strong>${this.escapeHtml(item.taskTitle || '')}</strong>`;
                            break;
                        case 'assigned':
                            const target = agents[item.target]?.name || item.target;
                            actionText = `assigned task to <strong>${target}</strong>`;
                            break;
                        case 'added':
                            actionText = `added a comment`;
                            break;
                        case 'moved':
                            actionText = `moved task to <strong>${item.to || ''}</strong>`;
                            break;
                        case 'completed':
                            actionText = `completed task <strong>${this.escapeHtml(item.taskTitle || '')}</strong>`;
                            break;
                        default:
                            actionText = item.action;
                    }
                    
                    return `
                        <div class="feed-item" data-type="${item.type}">
                            <div class="feed-item-avatar" style="background: ${agent.color}">${agent.department}</div>
                            <div class="feed-item-content">
                                <div class="feed-item-header">
                                    <span class="feed-item-agent">${agent.name}</span>
                                    <span class="feed-item-time">${timeAgo}</span>
                                </div>
                                <div class="feed-item-action">${actionText}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderAgentGrid() {
                const container = document.getElementById('agent-grid');
                if (!this.tasksData?.agents) return;

                const agents = this.tasksData.agents;
                container.innerHTML = Object.entries(agents).map(([key, agent]) => {
                    const status = this.getAgentStatus(key);
                    return `
                        <div class="agent-grid-item ${status === 'working' ? 'active' : ''}" 
                             style="background: ${agent.color}; color: #000"
                             title="${agent.name}">
                            ${agent.department}
                        </div>
                    `;
                }).join('');
            }

            updateFooter() {
                if (!this.tasksData?.tasks) return;
                
                const tasks = this.tasksData.tasks;
                const active = tasks.filter(t => t.status === 'in_progress').length;
                const pending = tasks.filter(t => t.status === 'inbox' || t.status === 'assigned').length;
                
                document.getElementById('footer-active').textContent = `${active} ACTIVE`;
                document.getElementById('footer-pending').textContent = `${pending} PENDING`;
                document.getElementById('footer-update').textContent = `Last Update: ${new Date().toLocaleTimeString()}`;
            }

            // Drag and Drop
            dragTask(event, taskId) {
                event.dataTransfer.setData('text/plain', taskId);
                event.target.classList.add('dragging');
            }

            dropTask(event, newStatus) {
                event.preventDefault();
                const taskId = event.dataTransfer.getData('text/plain');
                const draggedEl = document.querySelector('.task-card.dragging');
                if (draggedEl) draggedEl.classList.remove('dragging');
                
                // Send update to server
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({
                        type: 'update_task',
                        taskId: taskId,
                        updates: { status: newStatus }
                    }));
                }
            }

            // Task Modal
            openTask(taskId) {
                if (!this.tasksData?.tasks) return;
                
                const task = this.tasksData.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                this.selectedTaskId = taskId;
                const agents = this.tasksData.agents || {};
                const assignee = task.assignee ? agents[task.assignee] : null;
                
                document.getElementById('modal-task-title').textContent = task.title;
                document.getElementById('modal-task-desc').textContent = task.description || 'No description';
                
                // Meta
                document.getElementById('modal-task-meta').innerHTML = `
                    <div class="task-detail-meta-item">
                        <div class="task-detail-label">Status</div>
                        <div class="task-detail-value">${this.columnLabels[task.status] || task.status}</div>
                    </div>
                    <div class="task-detail-meta-item">
                        <div class="task-detail-label">Assignee</div>
                        <div class="task-detail-value">${assignee?.name || 'Unassigned'}</div>
                    </div>
                    <div class="task-detail-meta-item">
                        <div class="task-detail-label">Priority</div>
                        <div class="task-detail-value" style="color: ${task.priority === 'high' ? 'var(--status-alert)' : task.priority === 'medium' ? 'var(--status-warning)' : 'var(--lcars-violet)'}">${(task.priority || 'medium').toUpperCase()}</div>
                    </div>
                `;
                
                // Comments
                const commentsHtml = (task.comments || []).map(c => {
                    const author = agents[c.author] || { name: c.author, color: '#666', department: '?' };
                    return `
                        <div class="comment-item">
                            <div class="comment-avatar" style="background: ${author.color}">${author.department}</div>
                            <div class="comment-content">
                                <div class="comment-header">
                                    <span class="comment-author">${author.name}</span>
                                    <span class="comment-time">${this.formatTimeAgo(c.timestamp)}</span>
                                </div>
                                <div class="comment-text">${this.escapeHtml(c.text)}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                document.getElementById('modal-task-comments').innerHTML = `
                    <div class="task-detail-label">Comments (${(task.comments || []).length})</div>
                    ${commentsHtml || '<div style="color: var(--lcars-violet); font-size: 12px; padding: 10px 0;">No comments yet</div>'}
                `;
                
                document.getElementById('task-modal-overlay').classList.add('active');
            }

            addComment() {
                const input = document.getElementById('comment-input');
                const text = input.value.trim();
                if (!text || !this.selectedTaskId) return;
                
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({
                        type: 'add_comment',
                        taskId: this.selectedTaskId,
                        author: 'seven',
                        text: text
                    }));
                    input.value = '';
                }
            }

            formatTimeAgo(timestamp) {
                if (!timestamp) return '--';
                const diff = Date.now() - new Date(timestamp).getTime();
                const mins = Math.floor(diff / 60000);
                if (mins < 1) return 'just now';
                if (mins < 60) return `${mins}m ago`;
                const hours = Math.floor(mins / 60);
                if (hours < 24) return `${hours}h ago`;
                const days = Math.floor(hours / 24);
                return `${days}d ago`;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            startClock() {
                const updateClock = () => {
                    document.getElementById('clock').textContent = new Date().toLocaleTimeString('en-US', { 
                        hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'
                    });
                    
                    // Update stardate
                    const now = new Date();
                    const year = now.getFullYear();
                    const startOfYear = new Date(year, 0, 1);
                    const dayOfYear = Math.floor((now - startOfYear) / (1000 * 60 * 60 * 24));
                    const baseStardate = 47000 + ((year - 2024) * 1000);
                    const yearProgress = (dayOfYear / 365) * 1000;
                    document.getElementById('stardate').textContent = (baseStardate + yearProgress).toFixed(1);
                };
                updateClock();
                setInterval(updateClock, 1000);
            }
        }

        // Global functions
        function closeTaskModal() {
            document.getElementById('task-modal-overlay').classList.remove('active');
            if (window.mission) window.mission.selectedTaskId = null;
        }

        function showAddTask() {
            // For now, just alert - could expand to a form modal
            alert('Task creation coming soon! Tasks can be created via the API or by editing tasks.json');
        }

        // Initialize
        let mission;
        document.addEventListener('DOMContentLoaded', () => {
            mission = new MissionControl();
            window.mission = mission;
            console.log('[Mission] Control v1.0 initialized');
        });
    </script>
</body>
</html>
